const path = require('path');
const loaderUtils = require('loader-utils');
const readJSONSync = require('fs-extra').readJSONSync;

module.exports = function(source) {
  const { presentationPath } = loaderUtils.getOptions(this);
  let componentsList;

  try {
    const componentsJson = readJSONSync(path.join(presentationPath, 'common/components/components.json'));
    componentsList = JSON.stringify(componentsJson.components);
  }catch (err){
    componentsList = '{}'
  }

  return source.replace("'use strict'", `
  'use strict'; 
  window.__componentsList = ${componentsList};`);

}